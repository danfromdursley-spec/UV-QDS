<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>QDS ‚Ä¢ Learning Alphabet Lab v2+</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #020617;
      --bg-soft: #05091a;
      --panel: #020818;
      --border: #172033;
      --accent: #38bdf8;
      --accent-soft: rgba(56, 189, 248, 0.16);
      --text-main: #e5f6ff;
      --text-soft: #a5b4cc;
      --text-faint: #64748b;
      --chip-bg: #020617;
    }
    * { box-sizing: border-box; }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: radial-gradient(circle at top, #02041a, #00010a);
      color: var(--text-main);
    }
    .page {
      max-width: 1040px;
      margin: 0 auto;
      padding: 1rem 1rem 2.7rem;
    }
    header {
      background: radial-gradient(circle at top left, #0f172a, #020617);
      border-radius: 1rem;
      padding: 0.9rem 1rem 1rem;
      border: 1px solid var(--border);
      box-shadow: 0 18px 40px rgba(0,0,0,0.6);
      margin-bottom: 1rem;
    }
    header h1 {
      font-size: 1.4rem;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }
    header h1 span.logo {
      font-size: 1.6rem;
    }
    header p {
      margin: 0.25rem 0 0.65rem 0;
      font-size: 0.9rem;
      color: var(--text-soft);
    }

    .controls-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      align-items: center;
      margin-top: 0.15rem;
    }
    .controls-group {
      display: flex;
      flex-wrap: wrap;
      gap: 0.35rem;
      align-items: center;
    }
    .controls-group label {
      font-size: 0.8rem;
      color: var(--text-soft);
    }
    select {
      background: #020617;
      color: var(--text-main);
      border-radius: 999px;
      border: 1px solid var(--border);
      padding: 0.35rem 0.8rem;
      font-size: 0.85rem;
      outline: none;
    }
    .hint-pill {
      padding: 0.2rem 0.6rem;
      border-radius: 999px;
      background: #020617;
      border: 1px solid #1f2937;
      font-size: 0.75rem;
      color: var(--text-soft);
      max-width: 100%;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0.16rem 0.5rem;
      border-radius: 999px;
      font-size: 0.7rem;
      border: 1px solid #1f2937;
      background: #020617;
      color: #c3ddff;
    }
    .badge span {
      font-size: 0.85rem;
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.1fr);
      gap: 1rem;
    }
    @media (max-width: 840px) {
      .layout {
        grid-template-columns: minmax(0,1fr);
      }
    }

    .panel {
      background: radial-gradient(circle at top, #020a1c, var(--panel));
      border-radius: 0.9rem;
      padding: 0.8rem 0.9rem 0.95rem;
      border: 1px solid var(--border);
      box-shadow: 0 12px 30px rgba(0,0,0,0.55);
      min-height: 120px;
    }
    .panel-wide {
      grid-column: 1 / -1;
    }
    .panel h2 {
      font-size: 1rem;
      margin: 0 0 0.35rem 0;
      color: #f9fafb;
      display: flex;
      align-items: center;
      gap: 0.35rem;
    }
    .panel h2 span.icon {
      font-size: 1.1rem;
    }
    .panel-sub {
      font-size: 0.8rem;
      margin: 0 0 0.5rem 0;
      color: var(--text-soft);
    }

    .phoneme-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    .phoneme-card {
      border-radius: 0.8rem;
      padding: 0.4rem 0.55rem 0.45rem;
      min-width: 82px;
      background: radial-gradient(circle at top, #020617, #00010a);
      border: 1px solid #111827;
      box-shadow: 0 4px 10px rgba(0,0,0,0.4);
      font-size: 0.75rem;
      position: relative;
    }
    .phoneme-card::after {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: inherit;
      pointer-events: none;
      border: 1px solid rgba(255,255,255,0.02);
    }
    .phoneme-label-row {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 0.3rem;
      margin-bottom: 0.1rem;
    }
    .phoneme-label {
      font-weight: 700;
      font-size: 1.05rem;
    }
    .phoneme-emoji {
      font-size: 1rem;
      opacity: 0.95;
    }
    .phoneme-example {
      font-size: 0.7rem;
      color: #cbd5f5;
      margin-bottom: 0.2rem;
    }
    .phoneme-feature {
      font-size: 0.7rem;
      color: #a5b4fc;
      margin-bottom: 0.1rem;
    }
    .phoneme-gesture {
      font-size: 0.7rem;
      color: #fbbf24;
    }

    /* mode styling */
    .mode-classic .phoneme-card {
      background: radial-gradient(circle at top, #020617, #020313);
    }
    .mode-visual .phoneme-card {
      border-width: 2px;
    }
    .mode-logic .phoneme-card {
      border-style: dashed;
    }
    .mode-movement .phoneme-card {
      background: radial-gradient(circle at top, #001427, #020617);
    }

    .words-list {
      display: flex;
      flex-direction: column;
      gap: 0.55rem;
    }
    .word-card {
      border-radius: 0.85rem;
      padding: 0.5rem 0.6rem 0.5rem;
      background: radial-gradient(circle at top, #020617, #01010c);
      border: 1px solid #111827;
      font-size: 0.8rem;
    }
    .word-head {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 0.5rem;
      margin-bottom: 0.25rem;
    }
    .word-text {
      font-weight: 600;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }
    .word-emoji {
      font-size: 1rem;
    }
    .word-spelling {
      font-size: 0.75rem;
      color: #9ca3af;
    }
    .word-phon {
      font-size: 0.8rem;
      color: #e5e7eb;
      white-space: nowrap;
    }

    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: 0.3rem;
      margin-top: 0.1rem;
    }
    .chip {
      padding: 0.12rem 0.5rem 0.18rem;
      border-radius: 999px;
      font-size: 0.7rem;
      background: var(--chip-bg);
      border: 1px solid #1f2937;
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      box-shadow: 0 3px 8px rgba(0,0,0,0.45);
    }
    .chip-dot {
      width: 0.55rem;
      height: 0.55rem;
      border-radius: 999px;
      background: var(--accent);
    }
    .chip-emoji {
      font-size: 0.85rem;
    }
    .chip-note {
      font-size: 0.65rem;
      color: #eab308;
    }

    .word-note {
      font-size: 0.72rem;
      color: #facc15;
      margin-top: 0.22rem;
    }

    /* Play lab */
    .lab-columns {
      display: grid;
      grid-template-columns: minmax(0, 1.15fr) minmax(0, 1fr);
      gap: 0.7rem;
    }
    @media (max-width: 720px) {
      .lab-columns {
        grid-template-columns: minmax(0,1fr);
      }
    }
    .lab-block-title {
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }
    .lab-block-title span {
      font-size: 1rem;
    }
    .lab-sub {
      font-size: 0.75rem;
      color: var(--text-soft);
      margin-bottom: 0.35rem;
    }
    .build-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.3rem;
      margin-bottom: 0.35rem;
      align-items: center;
    }
    .build-label {
      font-size: 0.78rem;
      color: var(--text-soft);
    }
    .build-display {
      padding: 0.18rem 0.5rem;
      border-radius: 999px;
      background: #020617;
      border: 1px solid #1f2937;
      font-size: 0.78rem;
      min-height: 1.6rem;
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      flex-wrap: wrap;
    }
    .build-spelling {
      font-size: 0.75rem;
      color: #facc15;
    }
    .build-btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
      margin-bottom: 0.45rem;
    }
    .btn {
      border-radius: 999px;
      padding: 0.24rem 0.7rem;
      font-size: 0.75rem;
      border: 1px solid #1f2937;
      background: #020617;
      color: var(--text-main);
      cursor: pointer;
    }
    .btn-primary {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px var(--accent-soft);
    }
    .btn-ghost {
      opacity: 0.85;
    }
    .btn:active {
      transform: translateY(1px);
    }

    .pad-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 0.35rem;
      max-height: 140px;
      overflow-y: auto;
      padding-right: 0.1rem;
    }
    .pad-btn {
      border-radius: 999px;
      padding: 0.16rem 0.55rem;
      border: 1px solid #1f2937;
      background: #020617;
      font-size: 0.75rem;
      color: var(--text-main);
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      cursor: pointer;
      white-space: nowrap;
    }
    .pad-btn span {
      font-size: 0.9rem;
    }

    .quiz-box {
      border-radius: 0.9rem;
      border: 1px dashed #1f2937;
      padding: 0.4rem 0.55rem;
      background: #020617;
    }
    .quiz-word {
      font-size: 0.95rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.35rem;
      margin-bottom: 0.25rem;
    }
    .quiz-word span {
      font-size: 1.05rem;
    }
    .quiz-note {
      font-size: 0.75rem;
      color: var(--text-soft);
      margin-bottom: 0.35rem;
    }
    .quiz-phonemes {
      font-size: 0.8rem;
      color: var(--text-main);
      margin-bottom: 0.2rem;
    }
    .quiz-status {
      font-size: 0.7rem;
      color: #facc15;
    }

    footer {
      margin-top: 1.4rem;
      font-size: 0.75rem;
      color: var(--text-faint);
      display: flex;
      justify-content: space-between;
      gap: 1rem;
      flex-wrap: wrap;
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <h1><span class="logo">üî§</span> QDS ‚Ä¢ Learning Alphabet Lab v2+</h1>
      <p>One phoneme kernel, many ‚Äúalphabet skins‚Äù. Tune it to the brain in front of you, not the other way around.</p>
      <div class="controls-row">
        <div class="controls-group">
          <label for="profileSelect">Learner profile:</label>
          <select id="profileSelect">
            <option value="default">Default / mixed</option>
            <option value="visual">Visual pattern thinker</option>
            <option value="logic">Rule & pattern brain</option>
            <option value="movement">Movement / rhythm first</option>
            <option value="nd_mix">ND blend (autistic / ADHD etc.)</option>
          </select>
          <span class="hint-pill" id="profileHint"></span>
        </div>
        <div class="controls-group">
          <label for="modeSelect">View mode:</label>
          <select id="modeSelect">
            <option value="classic">Classic (phonics baseline)</option>
            <option value="visual">Visual chunks (colour + cards)</option>
            <option value="logic">Logic grid (features & rules)</option>
            <option value="movement">Movement (gestures & rhythm)</option>
          </select>
          <span class="hint-pill" id="modeHint"></span>
        </div>
        <span class="badge"><span>ü§ñ</span> QDS helper online (offline brain-AI)</span>
      </div>
    </header>

    <div class="layout">
      <!-- Phoneme panel -->
      <section class="panel" id="phonemePanel">
        <h2><span class="icon">üß©</span> Phoneme kernel</h2>
        <p class="panel-sub" id="phonemeSub">
          Shared sound set for all learners.
        </p>
        <div class="phoneme-grid" id="phonemeGrid"></div>
      </section>

      <!-- Words panel -->
      <section class="panel">
        <h2><span class="icon">üìö</span> Words built from kernel</h2>
        <p class="panel-sub">
          Same words, different ‚Äúalphabet skin‚Äù depending on mode.
        </p>
        <div class="words-list" id="wordsList"></div>
      </section>

      <!-- Play lab -->
      <section class="panel panel-wide">
        <h2><span class="icon">üéÆ</span> Play lab ‚Äì build & quiz</h2>
        <p class="panel-sub">
          Tap sounds to build words, see the kernel path, then flip a quick quiz. Great for kids *and* grown-ups.
        </p>

        <div class="lab-columns">
          <!-- Builder -->
          <div>
            <div class="lab-block-title"><span>üß±</span> Build a word</div>
            <div class="lab-sub">Tap sounds to build a path; spelling is just a skin on top.</div>

            <div class="build-row">
              <span class="build-label">Kernel path:</span>
              <div class="build-display" id="buildPathDisplay">
                <span class="build-placeholder">tap sounds below‚Ä¶</span>
              </div>
            </div>

            <div class="build-row">
              <span class="build-label">Spelling guess:</span>
              <div class="build-display">
                <span class="build-spelling" id="buildSpelling">‚Äî</span>
              </div>
            </div>

            <div class="build-btn-row">
              <button class="btn btn-primary" id="btnClearBuild">Clear</button>
              <button class="btn btn-ghost" id="btnUndoBuild">Undo last</button>
            </div>

            <div class="lab-sub">Tap any sound to add it to the path:</div>
            <div class="pad-grid" id="padGrid"></div>
          </div>

          <!-- Quiz -->
          <div>
            <div class="lab-block-title"><span>üéØ</span> Quick quiz</div>
            <div class="lab-sub">See the word, predict its kernel path, then flip the answer.</div>

            <div class="quiz-box">
              <div class="quiz-word" id="quizWord">
                <span>‚ú®</span>
                <span id="quizWordText">ship</span>
              </div>
              <div class="quiz-note" id="quizNote">Think: which chunks make this sound?</div>
              <div class="quiz-phonemes" id="quizPhonemes" style="display:none;"></div>
              <div class="quiz-status" id="quizStatus"></div>

              <div class="build-btn-row" style="margin-top:0.4rem;">
                <button class="btn btn-primary" id="btnRevealQuiz">Show kernel path</button>
                <button class="btn btn-ghost" id="btnNextQuiz">Next word</button>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>

    <footer>
      <div>Modes & profiles are just interfaces ‚Äì the underlying phoneme kernel stays the same.</div>
      <div>v2+ prototype ‚Ä¢ extend with more sounds, languages, and learner profiles.</div>
    </footer>
  </div>

  <script>
    // ---- Data: phoneme kernel ----
    const PHONEMES = [
      // consonants
      {
        id: "m",
        label: "m",
        example: "m-at",
        type: "consonant",
        place: "lips",
        manner: "nasal",
        voiced: true,
        color: "#22c55e",
        emoji: "üêª",
        gesture: "tap chest once"
      },
      {
        id: "n",
        label: "n",
        example: "n-et",
        type: "consonant",
        place: "front",
        manner: "nasal",
        voiced: true,
        color: "#22c55e",
        emoji: "üëÉ",
        gesture: "touch nose"
      },
      {
        id: "p",
        label: "p",
        example: "p-at",
        type: "consonant",
        place: "lips",
        manner: "stop",
        voiced: false,
        color: "#38bdf8",
        emoji: "üéà",
        gesture: "small finger pop"
      },
      {
        id: "t",
        label: "t",
        example: "t-ap",
        type: "consonant",
        place: "front",
        manner: "stop",
        voiced: false,
        color: "#38bdf8",
        emoji: "ü™µ",
        gesture: "tap finger on table"
      },
      {
        id: "k",
        label: "k",
        example: "k-it",
        type: "consonant",
        place: "back",
        manner: "stop",
        voiced: false,
        color: "#38bdf8",
        emoji: "üéØ",
        gesture: "small head nod"
      },
      {
        id: "s",
        label: "s",
        example: "s-un",
        type: "consonant",
        place: "front",
        manner: "fricative",
        voiced: false,
        color: "#f97316",
        emoji: "üêç",
        gesture: "snake hand wiggle"
      },
      {
        id: "sh",
        label: "sh",
        example: "sh-ip",
        type: "consonant",
        place: "middle",
        manner: "fricative",
        voiced: false,
        color: "#a855f7",
        emoji: "ü§´",
        gesture: "finger to lips"
      },
      {
        id: "ch",
        label: "ch",
        example: "ch-ip",
        type: "consonant",
        place: "front",
        manner: "affricate",
        voiced: false,
        color: "#ec4899",
        emoji: "üß±",
        gesture: "two-finger tap"
      },
      {
        id: "th",
        label: "th",
        example: "th-in",
        type: "consonant",
        place: "front",
        manner: "fricative",
        voiced: "mixed",
        color: "#fb923c",
        emoji: "ü¶∑",
        gesture: "thumb on chin"
      },

      // vowels / chunks
      {
        id: "a",
        label: "a",
        example: "c-a-t",
        type: "vowel",
        place: "front",
        manner: "short",
        voiced: true,
        color: "#facc15",
        emoji: "‚≠ê",
        gesture: "open hand forward"
      },
      {
        id: "e",
        label: "e",
        example: "b-e-d",
        type: "vowel",
        place: "front",
        manner: "short",
        voiced: true,
        color: "#facc15",
        emoji: "üìè",
        gesture: "small step"
      },
      {
        id: "i",
        label: "i",
        example: "f-i-sh",
        type: "vowel",
        place: "front",
        manner: "short",
        voiced: true,
        color: "#facc15",
        emoji: "üìå",
        gesture: "point up"
      },
      {
        id: "o",
        label: "o",
        example: "h-o-t",
        type: "vowel",
        place: "back",
        manner: "short",
        voiced: true,
        color: "#facc15",
        emoji: "üî•",
        gesture: "small circle in air"
      },
      {
        id: "ai",
        label: "ai",
        example: "r-ai-n",
        type: "vowel",
        place: "front",
        manner: "long",
        voiced: true,
        color: "#fbbf24",
        emoji: "üåà",
        gesture: "two steps forward"
      },
      {
        id: "ee",
        label: "ee",
        example: "s-ee",
        type: "vowel",
        place: "front",
        manner: "long",
        voiced: true,
        color: "#fbbf24",
        emoji: "üòä",
        gesture: "big smile"
      },
      {
        id: "oo",
        label: "oo",
        example: "m-oo-n",
        type: "vowel",
        place: "back",
        manner: "long",
        voiced: true,
        color: "#fbbf24",
        emoji: "üåï",
        gesture: "hands make circle"
      }
    ];

    // Mini word bank
    const WORDS = [
      {
        text: "ship",
        spelling: "ship",
        phonemes: ["sh", "i", "p"],
        emoji: "üö¢",
        note: "Shows chunk [sh] instead of s+h."
      },
      {
        text: "math",
        spelling: "math",
        phonemes: ["m", "a", "th"],
        emoji: "üßÆ",
        note: "Simple front-mouth consonants + short vowel."
      },
      {
        text: "tree",
        spelling: "tree",
        phonemes: ["t", "r?", "ee"],
        emoji: "üå≥",
        note: "Prototype: r? could be a later-stage add-on."
      },
      {
        text: "book",
        spelling: "book",
        phonemes: ["b?", "oo", "k"],
        emoji: "üìö",
        note: "Focus on [oo] as a stable vowel chunk."
      },
      {
        text: "night",
        spelling: "night",
        phonemes: ["n", "ai", "t"],
        emoji: "üåô",
        note: "Classic tricky spelling, clean phoneme path."
      }
    ];

    const modeDescriptions = {
      classic: "Plain phonics view ‚Äì label, example, basic type.",
      visual: "Colour-coded chunks ‚Äì good for visual pattern brains.",
      logic: "Feature grid: place / manner / voice. For rule-brains.",
      movement: "Gestures & rhythm ‚Äì sound as motion."
    };

    const profiles = {
      "default": {
        mode: "visual",
        hint: "Mixed / general group ‚Äì start visual, then try other modes."
      },
      "visual": {
        mode: "visual",
        hint: "Leans on colour + shape. Keep the visual cards visible while reading."
      },
      "logic": {
        mode: "logic",
        hint: "Enjoys patterns & rules. Make columns: place / manner / voice."
      },
      "movement": {
        mode: "movement",
        hint: "Needs motion first. Say the sound + do the gesture together."
      },
      "nd_mix": {
        mode: "visual",
        hint: "ND mix: keep colour+gesture, avoid overload. Short bursts, lots of control."
      }
    };

    // ---- DOM hooks ----
    const modeSelect = document.getElementById("modeSelect");
    const modeHint = document.getElementById("modeHint");
    const profileSelect = document.getElementById("profileSelect");
    const profileHint = document.getElementById("profileHint");
    const phonemeGrid = document.getElementById("phonemeGrid");
    const phonemePanel = document.getElementById("phonemePanel");
    const phonemeSub = document.getElementById("phonemeSub");
    const wordsList = document.getElementById("wordsList");

    const buildPathDisplay = document.getElementById("buildPathDisplay");
    const buildSpelling = document.getElementById("buildSpelling");
    const btnClearBuild = document.getElementById("btnClearBuild");
    const btnUndoBuild = document.getElementById("btnUndoBuild");
    const padGrid = document.getElementById("padGrid");

    const quizWordText = document.getElementById("quizWordText");
    const quizNote = document.getElementById("quizNote");
    const quizPhonemes = document.getElementById("quizPhonemes");
    const quizStatus = document.getElementById("quizStatus");
    const btnRevealQuiz = document.getElementById("btnRevealQuiz");
    const btnNextQuiz = document.getElementById("btnNextQuiz");

    // ---- Helpers ----
    function getPhonemeById(id) {
      return PHONEMES.find(p => p.id === id) || null;
    }

    // ---- Render phonemes ----
    function renderPhonemes(mode) {
      phonemeGrid.innerHTML = "";
      phonemePanel.classList.remove("mode-classic", "mode-visual", "mode-logic", "mode-movement");
      phonemePanel.classList.add("mode-" + mode);

      phonemeSub.textContent = modeDescriptions[mode] || "Shared sound set for all learners.";

      PHONEMES.forEach(p => {
        const card = document.createElement("div");
        card.className = "phoneme-card";

        if (mode === "visual" && p.color) {
          card.style.borderColor = p.color;
          card.style.boxShadow = "0 0 0 1px rgba(15,23,42,0.7), 0 0 16px " + p.color + "55";
        }

        const labelRow = document.createElement("div");
        labelRow.className = "phoneme-label-row";

        const label = document.createElement("div");
        label.className = "phoneme-label";
        label.textContent = p.label;

        const emoji = document.createElement("div");
        emoji.className = "phoneme-emoji";
        emoji.textContent = p.emoji || "";

        labelRow.appendChild(label);
        labelRow.appendChild(emoji);
        card.appendChild(labelRow);

        const ex = document.createElement("div");
        ex.className = "phoneme-example";
        ex.textContent = p.example || "";
        card.appendChild(ex);

        if (mode === "classic") {
          const feature = document.createElement("div");
          feature.className = "phoneme-feature";
          feature.textContent = p.type + " sound";
          card.appendChild(feature);
        } else if (mode === "visual") {
          const feature = document.createElement("div");
          feature.className = "phoneme-feature";
          feature.textContent = p.type === "vowel" ? "vowel chunk" : "consonant chunk";
          card.appendChild(feature);
        } else if (mode === "logic") {
          const feature = document.createElement("div");
          feature.className = "phoneme-feature";
          feature.textContent = "place: " + p.place + ", manner: " + p.manner + ", voice: " + p.voiced;
          card.appendChild(feature);
        } else if (mode === "movement") {
          const feature = document.createElement("div");
          feature.className = "phoneme-feature";
          feature.textContent = p.type === "vowel" ? "voice / breath shape" : "mouth action";
          card.appendChild(feature);

          const gest = document.createElement("div");
          gest.className = "phoneme-gesture";
          gest.textContent = p.gesture || "";
          card.appendChild(gest);
        }

        phonemeGrid.appendChild(card);
      });
    }

    // ---- Render words ----
    function renderWords(mode) {
      wordsList.innerHTML = "";

      WORDS.forEach(w => {
        const card = document.createElement("div");
        card.className = "word-card";

        const head = document.createElement("div");
        head.className = "word-head";

        const left = document.createElement("div");
        const wordText = document.createElement("div");
        wordText.className = "word-text";

        const wEmoji = document.createElement("span");
        wEmoji.className = "word-emoji";
        wEmoji.textContent = w.emoji || "";

        const wLabel = document.createElement("span");
        wLabel.textContent = w.text;

        wordText.appendChild(wEmoji);
        wordText.appendChild(wLabel);

        const wordSpell = document.createElement("div");
        wordSpell.className = "word-spelling";
        wordSpell.textContent = "spelling: " + w.spelling;

        left.appendChild(wordText);
        left.appendChild(wordSpell);

        const right = document.createElement("div");
        right.className = "word-phon";
        right.textContent = w.phonemes.join(" ‚Ä¢ ");

        head.appendChild(left);
        head.appendChild(right);
        card.appendChild(head);

        const chips = document.createElement("div");
        chips.className = "chips";

        w.phonemes.forEach(pid => {
          const chip = document.createElement("div");
          chip.className = "chip";

          const p = getPhonemeById(pid.replace("?", ""));
          const dot = document.createElement("span");
          dot.className = "chip-dot";

          if (p && p.color && mode === "visual") {
            dot.style.background = p.color;
          } else if (mode === "logic") {
            dot.style.background = "#38bdf8";
          } else if (mode === "movement") {
            dot.style.background = "#facc15";
          }

          chip.appendChild(dot);

          const label = document.createElement("span");
          label.textContent = pid;
          chip.appendChild(label);

          if (p && p.emoji && (mode === "visual" || mode === "movement")) {
            const ce = document.createElement("span");
            ce.className = "chip-emoji";
            ce.textContent = p.emoji;
            chip.appendChild(ce);
          }

          chips.appendChild(chip);
        });

        card.appendChild(chips);

        if (w.note) {
          const note = document.createElement("div");
          note.className = "word-note";
          note.textContent = w.note;
          card.appendChild(note);
        }

        wordsList.appendChild(card);
      });
    }

    // ---- Build lab ----
    let buildPath = [];

    function updateBuildDisplays() {
      buildPathDisplay.innerHTML = "";
      if (!buildPath.length) {
        const span = document.createElement("span");
        span.className = "build-placeholder";
        span.textContent = "tap sounds below‚Ä¶";
        buildPathDisplay.appendChild(span);
      } else {
        buildPath.forEach(id => {
          const chip = document.createElement("span");
          chip.className = "chip";
          const p = getPhonemeById(id.replace("?", ""));
          const dot = document.createElement("span");
          dot.className = "chip-dot";
          if (p && p.color) dot.style.background = p.color;
          const label = document.createElement("span");
          label.textContent = id;
          chip.appendChild(dot);
          chip.appendChild(label);
          if (p && p.emoji) {
            const ce = document.createElement("span");
            ce.className = "chip-emoji";
            ce.textContent = p.emoji;
            chip.appendChild(ce);
          }
          buildPathDisplay.appendChild(chip);
        });
      }

      if (!buildPath.length) {
        buildSpelling.textContent = "‚Äî";
      } else {
        // naive spelling: just join labels, but keep digraphs intact
        const guess = buildPath.join("");
        buildSpelling.textContent = guess;
      }
    }

    function renderPadGrid() {
      padGrid.innerHTML = "";

      PHONEMES.forEach(p => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "pad-btn";
        const emoji = document.createElement("span");
        emoji.textContent = p.emoji || "";
        const label = document.createElement("span");
        label.textContent = p.label;
        btn.appendChild(emoji);
        btn.appendChild(label);
        btn.addEventListener("click", () => {
          buildPath.push(p.id);
          updateBuildDisplays();
        });
        padGrid.appendChild(btn);
      });
    }

    // ---- Quiz ----
    let currentQuiz = null;
    let quizRevealed = false;

    function pickRandomWord() {
      const idx = Math.floor(Math.random() * WORDS.length);
      return WORDS[idx];
    }

    function startNewQuiz() {
      currentQuiz = pickRandomWord();
      quizRevealed = false;

      quizWordText.textContent = currentQuiz.text;
      quizNote.textContent = "Predict the kernel path. Then tap ‚ÄúShow kernel path‚Äù.";
      quizPhonemes.style.display = "none";
      quizPhonemes.textContent = "";
      quizStatus.textContent = "";
    }

    function revealQuiz() {
      if (!currentQuiz) return;
      quizPhonemes.style.display = "block";
      quizPhonemes.textContent = "kernel path: " + currentQuiz.phonemes.join(" ‚Ä¢ ");
      quizStatus.textContent = "Nice. Compare this path with what you guessed ‚Äì chunks first, letters later.";
      quizRevealed = true;
    }

    // ---- Mode & profile wiring ----
    function setMode(mode) {
      modeHint.textContent = modeDescriptions[mode] || "";
      renderPhonemes(mode);
      renderWords(mode);
    }

    function setProfile(profileKey) {
      const profile = profiles[profileKey] || profiles["default"];
      profileHint.textContent = profile.hint || "";
      // update mode but don't re-trigger profile change
      modeSelect.value = profile.mode;
      setMode(profile.mode);
    }

    modeSelect.addEventListener("change", function () {
      setMode(this.value);
    });

    profileSelect.addEventListener("change", function () {
      setProfile(this.value);
    });

    // ---- Buttons & events ----
    btnClearBuild.addEventListener("click", function () {
      buildPath = [];
      updateBuildDisplays();
    });
    btnUndoBuild.addEventListener("click", function () {
      buildPath.pop();
      updateBuildDisplays();
    });

    btnRevealQuiz.addEventListener("click", function () {
      revealQuiz();
    });
    btnNextQuiz.addEventListener("click", function () {
      startNewQuiz();
    });

    // ---- Boot ----
    (function boot() {
      // default profile -> visual mode
      profileSelect.value = "default";
      setProfile("default");
      renderPadGrid();
      buildPath = [];
      updateBuildDisplays();
      startNewQuiz();
    })();
  </script>
</body>
</html>
